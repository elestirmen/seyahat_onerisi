<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Rota Y√∂netim Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px;
            padding: 30px;
        }
        
        .route-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #007bff;
        }
        
        .route-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .route-type-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .route-type-walking { background: #e8f5e8; color: #27ae60; }
        .route-type-hiking { background: #fff3e0; color: #f57c00; }
        .route-type-cycling { background: #e3f2fd; color: #1976d2; }
        .route-type-driving { background: #fce4ec; color: #c2185b; }
        
        .difficulty-stars {
            color: #ffc107;
        }
        
        .route-stats {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        #map {
            height: 400px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .route-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .rating-slider {
            margin: 10px 0;
        }
        
        .rating-category {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .rating-category label {
            font-weight: 500;
            margin: 0;
        }
        
        .rating-value {
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">üó∫Ô∏è Rota Y√∂netim Paneli</h1>
            <div>
                <button class="btn btn-primary me-2" onclick="showCreateRouteModal()">
                    <i class="fas fa-plus me-2"></i>Yeni Rota
                </button>
                <a href="/poi_manager_ui.html" class="btn btn-outline-secondary">
                    <i class="fas fa-map-marker-alt me-2"></i>POI Y√∂netimi
                </a>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="row mb-4">
            <div class="col-md-3">
                <select class="form-select" id="typeFilter" onchange="filterRoutes()">
                    <option value="">T√ºm Rota T√ºrleri</option>
                    <option value="walking">üö∂ Y√ºr√ºy√º≈ü</option>
                    <option value="hiking">ü•æ Doƒüa Y√ºr√ºy√º≈ü√º</option>
                    <option value="cycling">üö¥ Bisiklet</option>
                    <option value="driving">üöó Araba</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="difficultyFilter" onchange="filterRoutes()">
                    <option value="">T√ºm Zorluk Seviyeleri</option>
                    <option value="1">‚≠ê √áok Kolay</option>
                    <option value="2">‚≠ê‚≠ê Kolay</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê Orta</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Zor</option>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê √áok Zor</option>
                </select>
            </div>
            <div class="col-md-3">
                <input type="number" class="form-control" id="maxDurationFilter" 
                       placeholder="Max S√ºre (dk)" onchange="filterRoutes()">
            </div>
            <div class="col-md-3">
                <button class="btn btn-outline-primary w-100" onclick="loadRoutes()">
                    <i class="fas fa-sync me-2"></i>Yenile
                </button>
            </div>
        </div>
        
        <!-- Routes List -->
        <div id="routesList">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Y√ºkleniyor...</span>
                </div>
                <p class="mt-3">Rotalar y√ºkleniyor...</p>
            </div>
        </div>
    </div>
    
    <!-- Create Route Modal -->
    <div class="modal fade" id="createRouteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üó∫Ô∏è Yeni Rota Olu≈ütur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createRouteForm">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Rota Adƒ± *</label>
                                <input type="text" class="form-control" id="routeName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Rota T√ºr√º *</label>
                                <select class="form-select" id="routeType" required>
                                    <option value="walking">üö∂ Y√ºr√ºy√º≈ü</option>
                                    <option value="hiking">ü•æ Doƒüa Y√ºr√ºy√º≈ü√º</option>
                                    <option value="cycling">üö¥ Bisiklet</option>
                                    <option value="driving">üöó Araba</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">A√ßƒ±klama</label>
                            <textarea class="form-control" id="routeDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Zorluk Seviyesi</label>
                                <select class="form-select" id="routeDifficulty">
                                    <option value="1">‚≠ê √áok Kolay</option>
                                    <option value="2">‚≠ê‚≠ê Kolay</option>
                                    <option value="3" selected>‚≠ê‚≠ê‚≠ê Orta</option>
                                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Zor</option>
                                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê √áok Zor</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Tahmini S√ºre (dk)</label>
                                <input type="number" class="form-control" id="routeDuration" min="1">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Mesafe (km)</label>
                                <input type="number" class="form-control" id="routeDistance" step="0.1" min="0">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Y√ºkselti (m)</label>
                                <input type="number" class="form-control" id="routeElevation" min="0">
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Etiketler</label>
                                <input type="text" class="form-control" id="routeTags" 
                                       placeholder="tarihi, doƒüa, macera...">
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="isCircular">
                                    <label class="form-check-label" for="isCircular">
                                        Dairesel Rota (Ba≈ülangƒ±√ß = Biti≈ü)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Route Ratings -->
                        <div class="mt-4">
                            <h6>üåü Rota Deƒüerlendirmeleri</h6>
                            <div id="routeRatings">
                                <!-- Rating sliders will be added here -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒ∞ptal</button>
                    <button type="button" class="btn btn-primary" onclick="createRoute()">
                        <i class="fas fa-save me-2"></i>Rota Olu≈ütur
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const apiBase = '/api';
        let routes = [];
        
        // Route rating categories
        const ROUTE_CATEGORIES = {
            'scenic_beauty': {name: 'Manzara', icon: 'fa-mountain', color: '#27AE60'},
            'historical': {name: 'Tarihi', icon: 'fa-landmark', color: '#8B4513'},
            'adventure': {name: 'Macera', icon: 'fa-hiking', color: '#D35400'},
            'family_friendly': {name: 'Aile Dostu', icon: 'fa-users', color: '#3498DB'},
            'photography': {name: 'Fotoƒüraf', icon: 'fa-camera', color: '#9B59B6'},
            'cultural': {name: 'K√ºlt√ºrel', icon: 'fa-palette', color: '#E74C3C'},
            'nature': {name: 'Doƒüa', icon: 'fa-leaf', color: '#27AE60'},
            'pilgrimage': {name: 'Hac/Ziyaret', icon: 'fa-pray', color: '#6C3483'}
        };
        
        // Load routes on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadRoutes();
            setupRatingSliders();
        });
        
        async function loadRoutes() {
            try {
                const response = await fetch(`${apiBase}/routes`);
                const data = await response.json();
                
                if (response.ok) {
                    routes = data.routes;
                    displayRoutes(routes);
                } else {
                    throw new Error(data.error || 'Rotalar y√ºklenemedi');
                }
            } catch (error) {
                console.error('Routes load error:', error);
                document.getElementById('routesList').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Rotalar y√ºklenirken hata olu≈ütu: ${error.message}
                    </div>
                `;
            }
        }
        
        function displayRoutes(routesToShow) {
            const container = document.getElementById('routesList');
            
            if (routesToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-route fa-3x text-muted mb-3"></i>
                        <h5>Hen√ºz rota bulunmuyor</h5>
                        <p class="text-muted">ƒ∞lk rotanƒ±zƒ± olu≈üturmak i√ßin "Yeni Rota" butonuna tƒ±klayƒ±n.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = routesToShow.map(route => `
                <div class="route-card">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="mb-2">${route.name}</h5>
                            <span class="route-type-badge route-type-${route.route_type}">
                                ${getRouteTypeIcon(route.route_type)} ${getRouteTypeName(route.route_type)}
                            </span>
                        </div>
                        <div class="text-end">
                            <div class="difficulty-stars mb-2">
                                ${getDifficultyStars(route.difficulty_level)}
                            </div>
                            <small class="text-muted">Zorluk: ${route.difficulty_level}/5</small>
                        </div>
                    </div>
                    
                    <p class="text-muted mb-3">${route.description || 'A√ßƒ±klama bulunmuyor'}</p>
                    
                    <div class="route-stats">
                        <div class="stat-item">
                            <div class="stat-value">${route.estimated_duration || 0}</div>
                            <div class="stat-label">Dakika</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${route.total_distance || 0}</div>
                            <div class="stat-label">Kilometre</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${route.elevation_gain || 0}</div>
                            <div class="stat-label">Y√ºkselti (m)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${route.poi_count || 0}</div>
                            <div class="stat-label">POI Sayƒ±sƒ±</div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div>
                            ${route.is_circular ? '<span class="badge bg-info">Dairesel Rota</span>' : ''}
                            ${route.tags ? `<small class="text-muted ms-2">${route.tags}</small>` : ''}
                        </div>
                        <div>
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="viewRoute(${route.id})">
                                <i class="fas fa-eye me-1"></i>G√∂r√ºnt√ºle
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="editRoute(${route.id})">
                                <i class="fas fa-edit me-1"></i>D√ºzenle
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function getRouteTypeIcon(type) {
            const icons = {
                'walking': 'üö∂',
                'hiking': 'ü•æ',
                'cycling': 'üö¥',
                'driving': 'üöó'
            };
            return icons[type] || 'üó∫Ô∏è';
        }
        
        function getRouteTypeName(type) {
            const names = {
                'walking': 'Y√ºr√ºy√º≈ü',
                'hiking': 'Doƒüa Y√ºr√ºy√º≈ü√º',
                'cycling': 'Bisiklet',
                'driving': 'Araba'
            };
            return names[type] || type;
        }
        
        function getDifficultyStars(level) {
            return '‚≠ê'.repeat(level) + '‚òÜ'.repeat(5 - level);
        }
        
        function filterRoutes() {
            const typeFilter = document.getElementById('typeFilter').value;
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const maxDurationFilter = document.getElementById('maxDurationFilter').value;
            
            let filtered = routes;
            
            if (typeFilter) {
                filtered = filtered.filter(route => route.route_type === typeFilter);
            }
            
            if (difficultyFilter) {
                filtered = filtered.filter(route => route.difficulty_level == difficultyFilter);
            }
            
            if (maxDurationFilter) {
                filtered = filtered.filter(route => 
                    route.estimated_duration <= parseInt(maxDurationFilter));
            }
            
            displayRoutes(filtered);
        }
        
        function showCreateRouteModal() {
            const modal = new bootstrap.Modal(document.getElementById('createRouteModal'));
            modal.show();
        }
        
        function setupRatingSliders() {
            const container = document.getElementById('routeRatings');
            
            Object.entries(ROUTE_CATEGORIES).forEach(([key, category]) => {
                container.innerHTML += `
                    <div class="rating-category">
                        <label>
                            <i class="fas ${category.icon} me-2" style="color: ${category.color}"></i>
                            ${category.name}
                        </label>
                        <div class="d-flex align-items-center">
                            <input type="range" class="form-range me-3" min="0" max="100" value="50" 
                                   id="rating_${key}" style="width: 150px;"
                                   oninput="updateRatingValue('${key}', this.value)">
                            <span class="rating-value" id="rating_${key}_value">50</span>
                        </div>
                    </div>
                `;
            });
        }
        
        function updateRatingValue(category, value) {
            document.getElementById(`rating_${category}_value`).textContent = value;
        }
        
        async function createRoute() {
            try {
                const formData = {
                    name: document.getElementById('routeName').value,
                    description: document.getElementById('routeDescription').value,
                    route_type: document.getElementById('routeType').value,
                    difficulty_level: parseInt(document.getElementById('routeDifficulty').value),
                    estimated_duration: parseInt(document.getElementById('routeDuration').value) || null,
                    total_distance: parseFloat(document.getElementById('routeDistance').value) || null,
                    elevation_gain: parseInt(document.getElementById('routeElevation').value) || null,
                    is_circular: document.getElementById('isCircular').checked,
                    tags: document.getElementById('routeTags').value,
                    ratings: {}
                };
                
                // Collect ratings
                Object.keys(ROUTE_CATEGORIES).forEach(key => {
                    const value = document.getElementById(`rating_${key}`).value;
                    if (value > 0) {
                        formData.ratings[key] = parseInt(value);
                    }
                });
                
                const response = await fetch(`${apiBase}/routes`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('createRouteModal')).hide();
                    document.getElementById('createRouteForm').reset();
                    loadRoutes();
                    
                    // Show success message
                    showNotification('Rota ba≈üarƒ±yla olu≈üturuldu!', 'success');
                } else {
                    throw new Error(result.error || 'Rota olu≈üturulamadƒ±');
                }
                
            } catch (error) {
                console.error('Route creation error:', error);
                showNotification('Rota olu≈üturulurken hata olu≈ütu: ' + error.message, 'error');
            }
        }
        
        function showNotification(message, type = 'info') {
            // Simple notification system
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-danger' : 'alert-info';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        function viewRoute(routeId) {
            // TODO: Implement route detail view
            console.log('View route:', routeId);
        }
        
        function editRoute(routeId) {
            // TODO: Implement route editing
            console.log('Edit route:', routeId);
        }
    </script>
</body>
</html>