<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - Sorun Tespiti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body data-page="debug">
    <div class="container mt-4">
        <h1><i class="fas fa-bug"></i> Debug Test - Sorun Tespiti</h1>
        
        <div class="alert alert-info">
            Bu sayfa mevcut sorunları tespit etmek için oluşturulmuştur.
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Modül Durumu</h5>
                    </div>
                    <div class="card-body">
                        <div id="module-status"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Butonları</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="testNotification()">Test Notification</button><br>
                        <button class="btn btn-secondary mb-2" onclick="testLoading()">Test Loading</button><br>
                        <button class="btn btn-info mb-2" onclick="testModal()">Test Modal</button><br>
                        <button class="btn btn-success mb-2" onclick="testAPI()">Test API</button><br>
                        <button class="btn btn-warning mb-2" onclick="checkGlobals()">Check Globals</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Console Log</h5>
            </div>
            <div class="card-body">
                <div id="console-log" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace;"></div>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript Loading -->
    <script type="module" src="/src/main.js"></script>
    
    <script>
        // Console override to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const logContainer = document.getElementById('console-log');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `text-${type === 'error' ? 'danger' : type === 'warn' ? 'warning' : 'dark'}`;
            logEntry.innerHTML = `<small>[${timestamp}]</small> ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };
        
        // Wait for app to be ready
        document.addEventListener('appReady', function(event) {
            console.log('✅ App ready event received:', event.detail);
            updateModuleStatus();
        });
        
        function updateModuleStatus() {
            const statusContainer = document.getElementById('module-status');
            const modules = [
                { name: 'CONSTANTS', obj: window.CONSTANTS },
                { name: 'DOMUtils', obj: window.DOMUtils },
                { name: 'notificationSystem', obj: window.notificationSystem },
                { name: 'loadingManager', obj: window.loadingManager },
                { name: 'Modal', obj: window.Modal },
                { name: 'FormBuilder', obj: window.FormBuilder },
                { name: 'UIPatterns', obj: window.UIPatterns },
                { name: 'apiClient', obj: window.apiClient },
                { name: 'mapInitializer', obj: window.mapInitializer },
                { name: 'showNotification', obj: window.showNotification },
                { name: 'showLoading', obj: window.showLoading }
            ];
            
            let html = '<ul class="list-group list-group-flush">';
            modules.forEach(module => {
                const status = module.obj ? 'success' : 'danger';
                const icon = module.obj ? 'check' : 'times';
                html += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${module.name}
                        <span class="badge bg-${status}">
                            <i class="fas fa-${icon}"></i>
                        </span>
                    </li>
                `;
            });
            html += '</ul>';
            statusContainer.innerHTML = html;
        }
        
        function testNotification() {
            if (window.showNotification) {
                window.showNotification('Test notification çalışıyor!', 'success');
                console.log('✅ Notification test successful');
            } else if (window.notificationSystem) {
                window.notificationSystem.show('Test notification çalışıyor!', 'success');
                console.log('✅ Direct notification system test successful');
            } else {
                console.error('❌ Notification system not available');
                alert('Notification system not available');
            }
        }
        
        function testLoading() {
            if (window.showLoading && window.hideLoading) {
                window.showLoading('Test loading...');
                setTimeout(() => {
                    window.hideLoading();
                    console.log('✅ Loading test successful');
                }, 2000);
            } else if (window.loadingManager) {
                window.loadingManager.showGlobal('Test loading...');
                setTimeout(() => {
                    window.loadingManager.hideGlobal();
                    console.log('✅ Direct loading manager test successful');
                }, 2000);
            } else {
                console.error('❌ Loading system not available');
                alert('Loading system not available');
            }
        }
        
        function testModal() {
            if (window.Modal) {
                const modal = new Modal({
                    title: 'Test Modal',
                    content: '<p>Modal test çalışıyor!</p>',
                    size: 'medium'
                });
                modal.show();
                console.log('✅ Modal test successful');
            } else {
                console.error('❌ Modal system not available');
                alert('Modal system not available');
            }
        }
        
        function testAPI() {
            if (window.apiClient) {
                window.apiClient.get('/health')
                    .then(response => {
                        console.log('✅ API test successful:', response);
                        if (window.showNotification) {
                            window.showNotification('API test successful', 'success');
                        }
                    })
                    .catch(error => {
                        console.log('⚠️ API test failed (expected):', error.message);
                        if (window.showNotification) {
                            window.showNotification('API test failed (expected)', 'warning');
                        }
                    });
            } else {
                console.error('❌ API client not available');
                alert('API client not available');
            }
        }
        
        function checkGlobals() {
            const globals = Object.keys(window).filter(key => 
                key.includes('notification') || 
                key.includes('loading') || 
                key.includes('Modal') || 
                key.includes('api') ||
                key.includes('CONSTANTS') ||
                key.includes('DOMUtils')
            );
            
            console.log('Available globals:', globals);
            
            // Check for conflicts
            const conflicts = [];
            if (window.showNotification && typeof window.showNotification !== 'function') {
                conflicts.push('showNotification is not a function');
            }
            if (window.showLoading && typeof window.showLoading !== 'function') {
                conflicts.push('showLoading is not a function');
            }
            
            if (conflicts.length > 0) {
                console.error('❌ Conflicts detected:', conflicts);
            } else {
                console.log('✅ No conflicts detected');
            }
        }
        
        // Initial status update
        setTimeout(updateModuleStatus, 1000);
    </script>
</body>
</html>